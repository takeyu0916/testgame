<!DOCTYPE html>
<html>
<head>
    <title>ãŸã‘ãã‚“ã®ãƒãƒƒãƒ”ãƒ¼ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #0b0d2b; } /* å®‡å®™ã£ã½ã„ç´ºè‰² */
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="module">
        import kaplay from "https://unpkg.com/kaplay@3001.0.0-alpha.20/dist/kaplay.mjs";

        const k = kaplay({
            width: 320,
            height: 480,
            letterbox: true,
            background: [11, 13, 43],
        });

        // è‡ªæ©Ÿï¼šã‹ã‚ã„ã„ãƒã‚³ã¡ã‚ƒã‚“ï¼ˆãŸã‘ãã‚“ï¼‰
        const player = k.add([
            k.text("ğŸ±", { size: 40 }), 
            k.pos(k.center().x, 420),
            k.anchor("center"),
            k.area(),
            "player"
        ]);

        // æ“ä½œï¼šã‚¹ãƒãƒ›ã®ã‚¿ãƒƒãƒ—ä½ç½®ã«åˆã‚ã›ã¦å·¦å³ã«å‹•ã
        k.onUpdate(() => {
            if (k.isMouseDown()) {
                const mpos = k.mousePos();
                if (mpos.x < player.pos.x - 10) player.move(-250, 0);
                if (mpos.x > player.pos.x + 10) player.move(250, 0);
            }
        });

        // å¼¾ï¼šã‚­ãƒ©ã‚­ãƒ©æ˜Ÿã‚’æ’ƒã¡å‡ºã™
        k.onMousePress(() => {
            k.add([
                k.text("âœ¨", { size: 24 }),
                k.pos(player.pos.x, player.pos.y - 30),
                k.anchor("center"),
                k.area(),
                k.move(k.UP, 500),
                k.offscreen({ destroy: true }),
                "bullet"
            ]);
        });

        // æ•µï¼šã„ã‚ã‚“ãªç¨®é¡ã®æ˜Ÿã‚„å®‡å®™äºº
        function spawnEnemy() {
            const enemies = ["â­", "ğŸŒŸ", "ğŸ‘¾", "ğŸ›¸"];
            const type = k.choose(enemies); // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶

            k.add([
                k.text(type, { size: 30 }),
                k.pos(k.rand(40, 280), -20),
                k.anchor("center"),
                k.area(),
                k.move(k.DOWN, k.rand(80, 150)), // ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚‚ãƒ©ãƒ³ãƒ€ãƒ 
                k.offscreen({ destroy: true }),
                "enemy"
            ]);
        }

        k.loop(1.2, () => spawnEnemy()); // 1.2ç§’ã”ã¨ã«å‡ºç¾

        // å½“ãŸã‚Šåˆ¤å®šï¼šå½“ãŸã£ãŸã‚‰ãƒãƒ¼ãƒˆãŒæ•£ã‚‹ï¼
        k.onCollide("bullet", "enemy", (b, e) => {
            k.destroy(b);
            k.destroy(e);
            addParticles(e.pos, "ğŸ’©");
            k.shake(2); // ã¡ã‚‡ã£ã¨ç”»é¢ã‚’æºã‚‰ã™
        });

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ¼”å‡º
        function addParticles(p, char) {
            for (let i = 0; i < 5; i++) {
                k.add([
                    k.text(char, { size: 16 }),
                    k.pos(p),
                    k.move(k.rand(0, 360), k.rand(50, 150)),
                    k.opacity(1),
                    k.lifespan(0.4),
                ]);
            }
        }

    </script>
</body>
</html>
