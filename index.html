<!DOCTYPE html>
<html>
<head>
    <title>ãŸã‘ãã‚“ã®çˆ†èµ°ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #0b0d2b; font-family: sans-serif; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="module">
        import kaplay from "https://unpkg.com/kaplay@3001.0.0-alpha.20/dist/kaplay.mjs";

        const k = kaplay({
            width: 320,
            height: 480,
            letterbox: true,
            background: [11, 13, 43],
        });

        // ã‚·ãƒ¼ãƒ³ç®¡ç†ï¼šãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ 
        k.scene("main", () => {
            let score = 0;
            let hp = 3;

            // ã‚¹ã‚³ã‚¢è¡¨ç¤º
            const scoreLabel = k.add([
                k.text(`Score: ${score}`, { size: 20 }),
                k.pos(20, 20),
            ]);

            // HPè¡¨ç¤º
            const hpLabel = k.add([
                k.text(`HP: ${"â¤ï¸".repeat(hp)}`, { size: 20 }),
                k.pos(20, 50),
            ]);

            // è‡ªæ©Ÿï¼ˆãƒã‚³ã¡ã‚ƒã‚“ï¼‰
            const player = k.add([
                k.text("ğŸ˜¸", { size: 40 }), 
                k.pos(k.center().x, 420),
                k.anchor("center"),
                k.area(),
                "player"
            ]);

            // æ“ä½œ
            k.onUpdate(() => {
                if (k.isMouseDown()) {
                    const mpos = k.mousePos();
                    if (mpos.x < player.pos.x - 10) player.move(-250, 0);
                    if (mpos.x > player.pos.x + 10) player.move(250, 0);
                }
            });

            // å¼¾
            k.onMousePress(() => {
                k.add([
                    k.text("âœ¨", { size: 24 }),
                    k.pos(player.pos.x, player.pos.y - 30),
                    k.anchor("center"),
                    k.area(),
                    k.move(k.UP, 500),
                    k.offscreen({ destroy: true }),
                    "bullet"
                ]);
            });

            // æ•µ
            function spawnEnemy() {
                const enemies = ["â­", "ğŸŒŸ", "ğŸ‘¾", "ğŸ›¸"];
                const e = k.add([
                    k.text(k.choose(enemies), { size: 30 }),
                    k.pos(k.rand(40, 280), -20),
                    k.anchor("center"),
                    k.area(),
                    k.move(k.DOWN, k.rand(100, 180)),
                    "enemy"
                ]);

                // ç”»é¢å¤–ï¼ˆä¸‹ï¼‰ã«å‡ºãŸæ™‚ã®å‡¦ç†
                e.onUpdate(() => {
                    if (e.pos.y > 480) {
                        k.destroy(e);
                        hp -= 1;
                        hpLabel.text = `HP: ${"â¤ï¸".repeat(hp)}`;
                        k.shake(5);
                        if (hp <= 0) {
                            k.go("lose", score); // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¼ãƒ³ã¸
                        }
                    }
                });
            }

            k.loop(1.0, () => spawnEnemy());

            // å½“ãŸã‚Šåˆ¤å®š
            k.onCollide("bullet", "enemy", (b, e) => {
                k.destroy(b);
                k.destroy(e);
                score += 10;
                scoreLabel.text = `Score: ${score}`;
                addParticles(e.pos, "ğŸ’©");
            });

            function addParticles(p, char) {
                for (let i = 0; i < 5; i++) {
                    k.add([
                        k.text(char, { size: 16 }),
                        k.pos(p),
                        k.move(k.rand(0, 360), k.rand(50, 150)),
                        k.opacity(1),
                        k.lifespan(0.3),
                    ]);
                }
            }
        });

        // ã‚·ãƒ¼ãƒ³ç®¡ç†ï¼šã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        k.scene("lose", (score) => {
            k.add([
                k.text("GAME OVER", { size: 32 }),
                k.pos(k.center()),
                k.anchor("center"),
            ]);

            k.add([
                k.text(`Score: ${score}`, { size: 24 }),
                k.pos(k.center().x, k.center().y + 50),
                k.anchor("center"),
            ]);

            k.add([
                k.text("Tap to Restart", { size: 16 }),
                k.pos(k.center().x, k.center().y + 100),
                k.anchor("center"),
            ]);

            k.onMousePress(() => k.go("main"));
        });

        // æœ€åˆã«ã‚²ãƒ¼ãƒ é–‹å§‹
        k.go("main");

    </script>
</body>
</html>

